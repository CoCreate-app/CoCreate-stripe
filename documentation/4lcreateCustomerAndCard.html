<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>CoCreate-api Documentation | CoCreateJS </title>
        <link rel="icon" type="image/png" sizes="32x32" href="https://cocreate.app/images/favicon.ico">
        <meta name="description" content="A simple HTML5 and pure javascript component. Easy configuration using data-attributes and highly styleable." />
        <meta name="keywords" content="helper classes, utility classes, css framework, css library, inline style classes" />
        <meta name="robots" content="index,follow" />
        
        <!-- CoCreate CSS -->
        <link rel="stylesheet" href="https://server.cocreate.app/css/CoCreate.min.css" type="text/css" />
        
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" crossorigin="anonymous" />    
        
        <!-- Codemirror -->
        <link rel="stylesheet" href="https://server.cocreate.app/CoCreate-plugins/CoCreate-codemirror/src/CoCreate-codemirror.css" type="text/css" />
        <link rel=stylesheet href="https://codemirror.net/lib/codemirror.css"  async defer>

        <!-- Highlight.js-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </head>

    <body>
        <div data-collection="" data-document_id="" name="" id="cocreate-api" class="padding:15px">
            <div class="display:flex flex-wrap:wrap justify-content:space-between">
                <div class="display:flex align-items:center">
                    <h2>CoCreate-api</h2>
                </div>
                <div class="display:flex align-items:center font-size:20px social_share" data-height="600" data-width="500" data-media="https://via.placeholder.com/300/09f/fff.png">
                    <a href="https://github.com/CoCreate-app/CoCreate-api" target="_blank" class="margin-right:15px"><i class="fab fa-github"></i></a>
                    <a class="margin-right:15px share" data-network='twitter' title="Share on twitter"><i class="fab fa-twitter"></i></a>
                    <a class="margin-right:15px share" data-network='facebook' title="Share on Facebook"><i class="fab fa-facebook"></i></a>
                    <a class="margin-right:15px share" data-network='instagram' title="Share on instagram"><i class="fab fa-instagram"></i></a>
                    <a class="margin-right:15px share" data-network='share' title="Share on share"><i class="fas fa-share-alt"></i></a>
                </div>
            </div>
            <p class="max-width:500px margin:20px_0px">In this section we will use cocreate-api to create a customer and create a letter using cocreate-actions.</p>
            <p class="max-width:500px margin:20px_0px">Cocreate-actions : Is a library that we use to chain any number of events to a single button</p>
            <div id="api-section" class="display:flex flex-wrap:wrap">
                <div class="flex-grow:1 min-width:300px width:50% padding:0px_10px margin:20px_0px">
                <h2 class="border-bottom:1px_solid_lightgrey padding:5px_0px">Install</h2>
                <pre><code class="language-javascript">npm install cocreate-api</code></pre>
                <p class="padding:10px_0px">Or you can use cdn link:</p>
                <pre><code class="language-javascript">https://cdn.cocreate.app/CoCreate-api.min.js</code></pre>

                <h2 class="border-bottom:1px_solid_lightgrey margin-top:80px padding:5px_0px">Usage</h2>
                    <div class="">
                        <p class="padding:10px_0px">According to the reference of the official documentation of stripe  <a href="https://stripe.com/docs/api/customers/create" target="_blank" >CREATE_CUSTOMER</a> and <a href="https://stripe.com/docs/api/cards/create" target="_blank">CREATE_CARD</a> </p>
                        <div class="flex-grow:1 min-width:300px width:100%">
                            <pre>
                                <code>
Name-file : index-connect.html

&#x3C;form  data-form_id=&#x22;stripe&#x22;&#x3E;
  &#x3C;input type=&#x22;text&#x22; data-stripe=&#x22;description&#x22; value=&#x22;descripcion Test Customer&#x22; &#x3E;
  &#x3C;input type=&#x22;text&#x22; data-stripe=&#x22;email&#x22; value=&#x22;customertest@cocreate.com&#x22; &#x3E;
  &#x3C;input type=&#x22;text&#x22; data-stripe=&#x22;source&#x22; value=&#x22;tok_amex&#x22; &#x3E;
  &#x3C;button type=&#x22;button&#x22; data-actions=&#x22;registerCustomerStripe, registerCardStripe&#x22; id=&#x22;register&#x22;&#x3E;create&#x3C;/button&#x3E;
&#x3C;/form&#x3E;
                                </code>
                            </pre>
                        </div>
                        
                        <p class="padding:10px_0px">An important aspect to take into account is the data attribute data-actions here the events that will be executed in an orderly manner are defined</p>
                        <div class="flex-grow:1 min-width:300px width:100%">
                            <pre>
                                <code>
Name-file : index-connect.html   

&#x3C;script type=&#x22;text/javascript&#x22; &#x3E;

var SessionStorage = window.sessionStorage

function sendDataWebSocket(type,idCustomer=null){
  var btn = document.querySelector(&#x27;button#register&#x27;);
  let dataToSend = cocreateStripeRegisterAPi.getDataJSON(btn,cocreateStripeRegisterAPi);
  dataToSend[&#x27;type&#x27;] = type;
  if(idCustomer!=null){
&#x9;  dataToSend[&#x27;customer_id&#x27;] = idCustomer;
&#x9;  //for create CARD
&#x9;  delete dataToSend[&#x27;description&#x27;];
&#x9;  delete dataToSend[&#x27;email&#x27;];
  }
  cocreateStripeRegisterAPi.socket(dataToSend,cocreateStripeRegisterAPi);
}

function fnRegisterCustomer(){
  sendDataWebSocket(&#x27;.createCustomerBtn&#x27;);
}

function fnRegisterCard(){
  sendDataWebSocket(&#x27;.createCardBtn&#x27;,SessionStorage[&#x27;customer_id&#x27;]);
}
  &#x9;
CoCreate.actions.registerEvent(&#x27;registerCustomerStripe&#x27;, fnRegisterCustomer, window, &#x27;eventRegisterCustomer&#x27;)
CoCreate.actions.registerEvent(&#x27;registerCardStripe&#x27;, fnRegisterCard, window, &#x27;eventRegisterCard&#x27;)
&#x3C;/script&#x3E;

                                </code>
                            </pre>
                        </div>

                        <p class="padding:10px_0px">The events previously defined in the button must be declared in the javascript code and define the appropriate logic for each event, cocreateActions always waits for an event to finish to start the second event, so we will see the second step below in overwriting the setResult</p>
                        <div class="flex-grow:1 min-width:300px width:100%">
                            <pre>
                                <code>
Name-file WebSocketServer = Cocreate-stripe.js   

........
switch (type) {
    case &#x27;.createCustomerBtn&#x27;:
        const customer = await stripe.customers.create(data);
        utils.send_response(that.wsManager,socket,{&#x22;type&#x22;:type,&#x22;response&#x22;:customer},send_response)
    break;
    case &#x27;.createCardBtn&#x27;:
        let id_customer = data[&#x27;customer_id&#x27;];
        delete data[&#x27;customer_id&#x27;];
        const card = await stripe.customers.createSource(
          id_customer,
          data
        );
        utils.send_response(that.wsManager,socket,{&#x22;type&#x22;:type,&#x22;response&#x22;:card},send_response)
    break;
}
........
                                </code>
                            </pre>
                        </div>

                        <p class="padding:10px_0px">Dispatch events to tell cocreate-actions when an event ends</p>
                        <div class="flex-grow:1 min-width:300px width:100%">
                            <pre>
                                <code>
Name-file FrontEnd = Cocreate-stripe.js   

var CocreateStripeAPi = function() {
...........
    this.setResult = function(data) {
        let type = data[&#x22;type&#x22;];
        switch(type){
            case &#x27;.createCustomerBtn&#x27;:
                var localstorage = window.sessionStorage;
                localstorage[&#x27;customer_id&#x27;] = data[&#x27;response&#x27;][&#x22;id&#x22;];
                if(data[&#x27;response&#x27;]){
                    document.dispatchEvent(new CustomEvent(&#x27;eventRegisterCustomer&#x27;));
                }
            break;
            case &#x27;.createCardBtn&#x27;:
                document.dispatchEvent(new CustomEvent(&#x27;eventRegisterCard&#x27;));
            break;
        }
    
    }
...........
}                                </code>
                            </pre>
                        </div>

<p class="padding:10px_0px">finally we observe a response, in the console that shows that the events were executed in a chained and correct way using the cocreate-actions bridge</p>
<p class="padding:10px_0px"><img src="img/create_card.png" width="98%"></p>

                        
                    </div>
                    
                </div>
                
                <div class="flex-grow:1 min-width:300px width:50% padding:0px_10px margin:20px_0px  border-bottom:1px_solid_lightgrey">
                    <!-- SandBox -->
                    <h2 class="border-bottom:1px_solid_lightgrey padding:5px_0px">Demo</h2>
                    <div class="position:sticky top:0 padding:15px_0px height:100vh">
    			    <div class="container svColumn overflow:hidden card border-radius:2px width:auto height:100%" id="form-sandbox">
    			       <div class="font-size:20px position:absolute top:10px right:10px opacity:0.6 z-index:7">
    			        <a class="margin-right:10px" id="preview" data-show="preview" data-hide="code"><i class="far fa-eye"></i></a>
    			        <a class="margin-right:10px hidden" id="code" data-show="code" data-hide="preview"><i class="fas fa-code"></i></a>
    			        <!--<a class="margin-right:10px"><i class="far fa-window-maximize"></i></a>-->
    					<a target="modal" href="module_activity_datatable.html"
    				  	     data-pass_collection="modules"
    				  	     data-pass_document_id=""
    				  	     data-pass_fetch_value=""
    				  	     data-pass_prefix=""
    				  	     data-pass_to="render"
    				  	     data-modal_width="600px"
    				  	     data-modal_height="400px"
    				  	     data-modal_color="#229954"
    				  	     data-modal_header="false"
    				  	     class="margin-right:10px">
    				  	    <i class="fas fa-external-link-alt"></i>
    				     </a>        
    				     <a class="fs-toggle margin-right:5px" target="#playground-1"><i class="fas fa-expand"></i></a>
    			        </div>
    			
    			        <div class="svRow">
    			            
    			            <div class="svColumn">
    			            	
    			                <div class="svPanel">
    			                    <div data-realtime="false"
    			                        data-collection="modules"
    			                        data-document_id="5eefe30952c6e94c75fb5e3f"
    			                        name="html" 
    			                        id="7" 
    			                        class="codemirror min-width:300px">
    			                    </div>
    			                </div>
    			            	<div class="svSplitter svHorizontal"> </div>
    			
    			                <div class="svPanel">
    			                    <iframe data-get_value="7" frameBorder="0" height="100%" width="100%"  class="min-width:300px"></iframe>
    			                </div>
    			                
    			            </div>
    			        </div>
    			    </div>
    			    <!-- End SandBox -->
    			    </div>
                </div>
                
            </div>				
        </div>
        <script>
            var config = {
                apiKey: 'c2b08663-06e3-440c-ef6f-13978b42883a',
                securityKey: 'f26baf68-e3a9-45fc-effe-502e47116265',
                organization_Id: '5de0387b12e200ea63204d6c'
            }
        </script>
    
        <!--CoCreateJS-->
        <script src="https://server.cocreate.app/js/CoCreate.min.js"></script>
        
        <!-- CoCreate CodeMiirror -->
        <script type="text/javascript" src="https://server.cocreate.app/CoCreate-plugins/CoCreate-codemirror/dist/CoCreate-codemirror.js" async></script>
        
    </body>
</html>