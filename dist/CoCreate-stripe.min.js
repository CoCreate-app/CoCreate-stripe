/* CoCreateJS */
let customerBtns=document.querySelectorAll(".stripeCustomerBtn"),cardTokenBtns=document.querySelectorAll(".stripeCardTokenBtn"),cardBtns=document.querySelectorAll(".stripeCardBtn"),chargeBtns=document.querySelectorAll(".stripeChargeBtn"),transferBtns=document.querySelectorAll(".stripeTransferBtn"),stripeBtns=document.querySelectorAll(".stripeBtn");for(let e of customerBtns)e.form&&initStripeCustomerBtn(e.form,e);for(let e of cardTokenBtns)e.form&&initStripeCardTokenBtn(e.form,e);for(let e of cardBtns)e.form&&initStripeCardBtn(e.form,e);for(let e of chargeBtns)e.form&&initStripeChargeBtn(e.form,e);for(let e of stripeBtns)e.form&&initStripeBtn(e.form,e);for(let e of transferBtns)e.form&&initStripeTransferBtn(e.form,e);function initStripeCustomerBtn(e,t){t.addEventListener("click",t=>{t.preventDefault();let r=e.querySelector("[data-stripe_customer='customerId']");r&&r.value?updateStripeCustomer(r.value,e,(e,t)=>{console.log(e),console.log(t)}):createStripeCustomer(e,(t,r)=>{if(t){console.log(t);let r=e.querySelector("[data-stripe_customer='customerId']");r&&(r.value=t.id,r.dispatchEvent(new Event("input",{bubbles:!0})))}else console.log(r)})})}function initStripeCardTokenBtn(e,t){t.addEventListener("click",t=>{t.preventDefault(),createStripeCardToken(e,(t,r)=>{if(console.log(t),t){let r=e.querySelector("[data-stripe_cardtoken='tokenId']");r&&(r.value=t.id,r.dispatchEvent(new Event("input",{bubbles:!0})))}console.log(r)})})}function initStripeCardBtn(e,t){t.addEventListener("click",t=>{t.preventDefault();let r=e.querySelector("[data-stripe_customer='customerId']");if(r&&r.value){let t=r.value,a=e.querySelector("[data-stripe_card='cardId']");a&&a.value?updateStripeCard(t,a.value,e,(e,t)=>{console.log(e),console.log(t)}):createStripeCard(e,(t,r)=>{if(t){let r=e.querySelector("[data-stripe_card='cardId']");r&&(r.value=t.id,r.dispatchEvent(new Event("input",{bubbles:!0})))}else console.log(r)})}})}function initStripeChargeBtn(e,t){t.addEventListener("click",t=>{t.preventDefault();let r=e.querySelector("[data-stripe_charge='chargeId']");r&&r.value?updateStripeCharge(r.value,e,(e,t)=>{}):createStripeCharge(e,(t,r)=>{if(console.log(t),t){let r=e.querySelector("[data-stripe_charge='chargeId']");r&&(r.value=t.id,r.dispatchEvent(new Event("input",{bubbles:!0})))}console.log(r)})})}function initStripeTransferBtn(e,t){t.addEventListener("click",t=>{t.preventDefault(),createStripeTransfer(e,(e,t)=>{console.log(e)})})}function createStripeCustomer(e,t){let r={};e.querySelectorAll("[data-stripe_customer]").forEach(e=>{let t=e.getAttribute("data-stripe_customer"),a=e.value;"checkbox"==e.type&&(a=e.checked),t&&"customerId"!==t&&(r[t]=a)}),axios.post("/stripe/createCustomer",{param:r}).then(e=>{e.data.success?t(e.data.data,null):t(null,"error")}).catch(e=>{})}function updateStripeCustomer(e,t,r){let a={};t.querySelectorAll("[data-stripe_customer]").forEach(e=>{let t=e.getAttribute("data-stripe_customer"),r=e.value;"checkbox"==e.type&&(r=e.checked),t&&"customerId"!==t&&(a[t]=r)}),axios.post("/stripe/updateCustomer",{param:{customer:e,customerParam:a}}).then(e=>{e.data.success?r(e.data.data,null):r(null,"error")}).catch(e=>{})}function createStripeCardToken(e,t){let r={};e.querySelectorAll("[data-stripe_cardtoken]").forEach(e=>{let t=e.getAttribute("data-stripe_cardtoken"),a=e.value;"checkbox"==e.type&&(a=e.checked),t&&"tokenId"!=t&&(r[t]=a)}),console.log(r),axios.post("/stripe/createToken",{param:{card:r}}).then(e=>{e.data.success?t(e.data.data,null):t(null,"error")}).catch(e=>{})}function createStripeCard(e,t){let r=e.querySelector("[data-stripe_customer='customerId']"),a=e.querySelector("[data-stripe_cardtoken='tokenId']");if(!r||!r.value)return alert("require customerId"),void t(null,"require customerid");if(!a||!a.value)return alert("require cardTokenId"),void t(null,"require cardTokenId");let c=r.value,o=a.value;console.log(c,o),axios.post("/stripe/createCard",{param:{customerId:c,tokenId:o}}).then(e=>{e.data.success?t(e.data.data,null):t(null,"error")}).catch(e=>{})}function updateStripeCard(e,t,r,a){let c={};r.querySelectorAll("[data-stripe_card]").forEach(e=>{let t=e.getAttribute("data-stripe_card"),r=e.value;"checkbox"==e.type&&(r=e.checked),t&&"cardId"!=t&&(c[t]=r)}),axios.post("/stripe/updateCard",{param:{customerId:e,cardId:t,cardParam:c}}).then(e=>{e.data.success?a(e.data.data,null):a(null,"error")}).catch(e=>{})}function createStripeCharge(e,t){let r,a,c={},o={};e.querySelectorAll("[data-stripe_charge]").forEach(e=>{let t=e.getAttribute("data-stripe_charge"),o=e.value;"checkbox"==e.type&&(o=e.checked),t&&"chargeId"!=t&&"stripe_account"!=t&&"destination"!=t?c[t]=o:"stripe_account"==t?r=o:"destination"==t&&(a=o)});let n=e.querySelector("[data-stripe_customer='customerId']"),l=e.querySelector("[data-stripe_card='cardId']"),d=e.querySelector("[data-stripe_cardtoken='tokenId']");if(l&&l.value){if(!n||!n.value)return alert("require customerId"),void t(null,"require customerid");o={charge:{customer:n.value,source:l.value,...c},stripe_account:r,destination:a},console.log(o)}else{if(!d||!d.value)return;o={charge:{source:d.value,...c},stripe_account:r,destination:a},console.log(o)}axios.post("/stripe/createCharge",{param:o}).then(e=>{e.data.success?t(e.data.data,null):t(null,"error")}).catch(e=>{})}function updateStripeCharge(e,t,r){let a={};t.querySelectorAll("[data-stripe_charge]").forEach(e=>{let t=e.getAttribute("data-stripe_charge"),r=e.value;"checkbox"==e.type&&(r=e.checked),t&&"chargeId"!=t&&(a[t]=r)}),axios.post("/stripe/updateCharge",{param:{chargeId:e,chargeParam:a}}).then(e=>{e.data.success?r(e.data.data,null):r(null,"error")}).catch(e=>{})}function createStripeTransfer(e,t){let r={};e.querySelectorAll("[data-stripe_transfer").forEach(e=>{let t=e.getAttribute("data-stripe_transfer"),a=e.value;"checkbox"==e.type&&(a=e.checked),t&&"cardId"!=t&&(r[t]=a)}),console.log(r),axios.post("/stripe/createTransfer",{param:r}).then(e=>{e.data.success?t(e.data.data,null):t(null,"error")}).catch(e=>{})}function initStripeBtn(e,t){t.addEventListener("click",t=>{t.preventDefault();let r=e.querySelector("[data-stripe_customer='customerId']");if(r){if(r.value){let t=e.querySelector("[data-stripe_card='cardId']");t&&t.value?createStripeCharge(e,(e,t)=>{console.log(e)}):createStripeCardToken(e,(r,a)=>{if(!r)return;let c=e.querySelector("[data-stripe_cardtoken='tokenId']");c||((c=document.createElement("input")).setAttribute("data-stripe_cardtoken","tokenId"),c.setAttribute("type","hidden"),e.appendChild(c)),c.value=r.id,createStripeCard(e,(r,a)=>{r&&(t||((t=document.createElement("input")).setAttribute("data-stripe_card","cardId"),t.setAttribute("type","hidden"),e.appendChild(t)),t.value=r.id,createStripeCharge(e,(e,t)=>{console.log(e)}))})})}else createStripeCustomer(e,(t,a)=>{t&&(r.value=t.id,createStripeCardToken(e,(t,r)=>{if(!t)return;let a=e.querySelector("[data-stripe_cardtoken='tokenId']");a||((a=document.createElement("input")).setAttribute("data-stripe_cardtoken","tokenId"),a.setAttribute("type","hidden"),e.appendChild(a)),a.value=t.id,createStripeCard(e,(t,r)=>{if(!t)return;let a=e.querySelector("[data-stripe_card='cardId']");a||((a=document.createElement("input")).setAttribute("data-stripe_card","cardId"),a.setAttribute("type","hidden"),e.appendChild(a)),a.value=t.id,createStripeCharge(e,(e,t)=>{console.log(e)})})}))})}else createStripeCardToken(e,(t,r)=>{if(!t)return;let a=e.querySelector("[data-stripe_cardtoken='tokenId']");a||((a=document.createElement("input")).setAttribute("data-stripe_cardtoken","tokenId"),a.setAttribute("type","hidden"),e.appendChild(a)),a.value=t.id,createStripeCharge(e,(e,t)=>{console.log(e)})})})}var transferBtn=document.querySelector("#transferBtn");transferBtn.addEventListener("click",e=>{e.preventDefault(),axios.post("/stripe/getBalance",function(e){console.log(e)})});